<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Editar Excursión</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
    form { background: white; padding: 20px; border-radius: 8px; max-width: 600px; margin: auto; }
    label { display: block; margin-top: 10px; }
    input, textarea, select { width: 100%; padding: 8px; margin-top: 4px; }
    button { margin-top: 20px; padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #218838; }
  </style>
</head>
<body>
  <h2>Editar excursión existente</h2>
  <select id="excursion-selector"></select>
  <form id="edit-form" style="display:none;">
    <input type="hidden" name="rowIndex">
    <label>Nombre:<input type="text" name="name" required></label>
    <label>Descripción:<textarea name="description" required></textarea></label>
    <label>Categoría:<input type="text" name="category" required></label>
    <label>Precio:<input type="number" name="price" required></label>
    <label>Precio original:<input type="number" name="originalPrice"></label>
    <label>¿Recomendado? (true/false):<input type="text" name="recommended"></label>
    <label>Horario:<input type="text" name="schedule"></label>
    <label>Actividades:<input type="text" name="activities"></label>
    <label>Latitud:<input type="text" name="origin_lat"></label>
    <label>Longitud:<input type="text" name="origin_lng"></label>
    <button type="submit">Guardar cambios</button>
  </form>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbzzy2QLUZDRwIl0UQF6RrvfXz8Cb_YyfVa3aqP8fZiQE36iJW8d5FEGn5zcKd8kskR4/exec';

    let excursions = [];

    fetch(API_URL)
      .then(res => res.json())
      .then(data => {
        excursions = data;
        const selector = document.getElementById('excursion-selector');
        selector.innerHTML = data.map((ex, i) =>
          `<option value="${i}">${ex.name}</option>`
        ).join('');
      });

    document.getElementById('excursion-selector').addEventListener('change', (e) => {
      const index = e.target.value;
      const excursion = excursions[index];
      const form = document.getElementById('edit-form');
      form.style.display = 'block';
      Object.keys(excursion).forEach(key => {
        if (form.elements[key] && key !== 'image') {
          form.elements[key].value = excursion[key];
        }
      });
    });

    document.getElementById('edit-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = {};
      formData.forEach((value, key) => data[key] = value);

      // Mantener el enlace original de la imagen
      const selectedIndex = document.getElementById('excursion-selector').value;
      data.image = excursions[selectedIndex].image;

      fetch(API_URL, {
        method: 'POST',
        body: JSON.stringify(data),
        headers: { 'Content-Type': 'application/json' }
      })
      .then(res => res.text())
      .then(msg => {
        alert("Excursión actualizada correctamente ✅");
      })
      .catch(err => {
        console.error("Error al actualizar:", err);
        alert("Hubo un error al guardar los cambios.");
      });
    });
  </script>
</body>
</html>