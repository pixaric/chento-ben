<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Editar Excursión</title>
  <link rel="stylesheet" href="assets/styles/editar.css">
</head>
<body>
  <h2>Editar excursión existente</h2>
  <select id="excursion-selector">
  <option disabled selected>Selecciona una excursión</option>
</select>

  <form id="edit-form">
    <input type="hidden" name="rowIndex" id="rowIndex">
    <label>Nombre:<input type="text" name="name" id="name" required></label>
    <label>Descripción:<textarea name="description" id="description" required></textarea></label>
    <label>Categoría:
  <select name="category" id="category" required>
    <option value="barco">Barco</option>
    <option value="buggy">Buggy</option>
    <option value="excursiones">Excursiones</option>
    <option value="jetcor">Jetcor</option>
    <option value="jetsky">Jetsky</option>
    <option value="movilite">Movilite</option>
    <option value="quad">Quad</option>
    <option value="velero">Velero</option>
  </select>
</label>
    <label>Precio:<input type="number" name="price" id="price" required></label>
    <label>Precio original:<input type="number" name="originalPrice" id="originalPrice"></label>
    <label>¿Recomendado?:
  <select name="recommended" id="recommended">
    <option value="true">Sí</option>
    <option value="false">No</option>
  </select>
</label>
    <label>Horario:<input type="text" name="schedule" id="schedule"></label>
    <label>Actividades:<input type="text" name="activities" id="activities"></label>

    <label>Ubicación (Google Maps):<input type="text" name="location_url" id="location_url"></label>


    <button type="submit">Guardar cambios</button>
  </form>

  

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbytbJaq7xFblcFv-tqWzcFR03SF2CjMoOdz6yqDQNdoAe1l_TpdxCDSlbjcgHPQGzYw/exec';
    let excursions = [];

    fetch(API_URL)
      .then(res => res.json())
      .then(data => {
        excursions = data;
        const selector = document.getElementById('excursion-selector');
        const cards = document.getElementById('excursion-cards');
        selector.innerHTML = `
  <option disabled selected>Selecciona una excursión</option>
  ${data.map((ex, i) => `<option value="${i}">${ex.name}</option>`).join('')}
`;
        cards.innerHTML = data.map(ex => `
          <div class="card" id="excursion-${ex.rowIndex}">
            <h3>${ex.name}</h3>
            <p>${ex.description}</p>
            <p>Precio: €${ex.price}</p>
          </div>
        `).join('');
      });

    document.getElementById('excursion-selector').addEventListener('change', (e) => {
      const index = e.target.value;
      const excursion = excursions[index];
      document.getElementById('rowIndex').value = excursion.rowIndex;
      document.getElementById('name').value = excursion.name;
      document.getElementById('description').value = excursion.description;
      document.getElementById('category').value = excursion.category || "";
      document.getElementById('price').value = excursion.price;
      document.getElementById('originalPrice').value = excursion.originalPrice;
      document.getElementById('recommended').value = String(excursion.recommended);
      document.getElementById('schedule').value = excursion.schedule;
      document.getElementById('activities').value = excursion.activities;
      document.getElementById('location_url').value = excursion.location_url || "";

    });

    document.getElementById('edit-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = {};
      formData.forEach((value, key) => data[key] = value);

      fetch(API_URL, {
        method: 'POST',
        body: new URLSearchParams(data)
      })
      .then(res => res.text())
      .then(msg => {
        const card = document.getElementById(`excursion-${data.rowIndex}`);
        if (card) {
          card.querySelector('h3').textContent = data.name;
          card.querySelector('p:nth-of-type(1)').textContent = data.description;
          card.querySelector('p:nth-of-type(2)').textContent = `Precio: €${data.price}`;
        }

        const confirm = document.createElement('div');
        confirm.className = 'confirm';
        confirm.textContent = "✅ Excursión actualizada correctamente";
        e.target.appendChild(confirm);
        setTimeout(() => confirm.remove(), 3000);
      })
      .catch(err => {
        console.error("Error al actualizar:", err);
        alert("Hubo un error al guardar los cambios.");
      });
    });
  </script>
</body>
</html>